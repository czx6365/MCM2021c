# Mathematical Modeling Documentation: Performance Metrics & Indicators (T1-T5)

## Overview
This document summarizes all mathematical metrics, indicators, and evaluation criteria used across Tasks T1-T5 in the spatiotemporal prediction and decision support system for invasive species management.

---

## T1: Spatiotemporal Prediction Precision

### 1.1 Time Decay Weight
**Formula:**
$$w_t = \exp\left(-\frac{\Delta t}{\tau}\right)$$

**Parameters:**
- $\Delta t$: Time difference (days) between query date and historical detection
- $\tau$: Time decay constant (default: 180 days)

**Purpose:** Models temporal relevance decay of historical infestation data.

---

### 1.2 Spatial Kernel Weight
**Formula:**
$$w_s = \exp\left(-\frac{d^2}{2\sigma^2}\right)$$

**Parameters:**
- $d$: Haversine distance (km) between query point and historical detection
- $\sigma$: Spatial bandwidth (default: 50 km)

**Purpose:** Gaussian kernel for spatial proximity weighting.

---

### 1.3 Risk Density Score
**Formula:**
$$R(x,t) = \sum_{i=1}^{N} w_t^{(i)} \cdot w_s^{(i)}$$

**Purpose:** Combined spatiotemporal risk intensity at location $x$ and time $t$.

---

### 1.4 Hit Rate (Prediction Accuracy)
**Formula:**
$$\text{Hit Rate} = \frac{\text{\# Positives in Top } q\% \text{ Risk Regions}}{\text{Total \# Positives in Test Set}}$$

**Parameters:**
- $q$: Quantile threshold (default: 90%, i.e., top 10% risk areas)

**Purpose:** Measures model's ability to concentrate true positives in high-risk predictions.

---

### 1.5 Block Bootstrap Confidence Interval
**Method:** Resampling blocks of size $b$ (default: 5) with replacement over $B$ iterations (default: 1000).

**Output:** 95% CI $[\text{CI}_{0.025}, \text{CI}_{0.975}]$ for mean hit rate.

**Purpose:** Accounts for temporal autocorrelation in time series validation.

---

## T2: Image-Enhanced Risk Classification

### 2.1 CNN Feature Extraction
**Model:** Frozen ResNet-18 (512-dimensional embedding per image)

**Aggregation (Multiple Images per Report):**
$$\text{Feature}_{agg} = \left\{\text{mean}(f_1, \ldots, f_n), \, n_{\text{images}}\right\}$$

**Purpose:** Captures visual evidence quality.

---

### 2.2 Image Probability ($p_{\text{img}}$)
**Model:** Logistic Regression on CNN features

**Output:** $p_{\text{img}} \in [0,1]$ (probability of true positive based on images)

---

### 2.3 Risk Prior ($\text{risk\_prior}$)
Computed using T1 spatiotemporal kernel density on historical positives.

**Transformed:** $\text{risk\_prior\_log} = \log(1 + \text{risk\_prior})$

---

### 2.4 Final Positive Probability
**Model:** Logistic Regression with features:
$$\mathbf{X} = [p_{\text{img}}, \, \log(\text{risk\_prior}), \, \text{text features}, \, \text{temporal features}, \, \text{geo coords}]$$

**Output:** $p_{\text{positive}} \in [0,1]$

---

### 2.5 Text Features
- `note_length`: Character count in Notes field
- `kw_large`, `kw_yellow`, `kw_queen`: Binary keyword indicators

---

### 2.6 Temporal Features
- `month`: Month of detection (1-12)
- `delay_days`: $\max(0, \, \text{Submission Date} - \text{Detection Date})$

---

### 2.7 Evaluation Metrics

#### AUROC (Area Under ROC Curve)
$$\text{AUROC} = P(\hat{y}_{\text{pos}} > \hat{y}_{\text{neg}})$$
**Range:** [0.5, 1.0] (0.5 = random, 1.0 = perfect)

#### AUPRC (Area Under Precision-Recall Curve)
Better for imbalanced datasets than AUROC.

#### Top-K Uplift
**Formula:**
$$\text{Uplift}_k = \frac{\text{Positive Rate in Top } k\%}{\text{Overall Positive Rate}}$$

**Interpretation:** Uplift > 1 indicates model successfully concentrates high-risk cases.

---

### 2.8 Statistical Significance (Logit Model)
**Output from `statsmodels`:**
- Coefficient estimates
- Standard errors
- $z$-scores
- $p$-values (H₀: coefficient = 0)
- 95% Confidence intervals

**Purpose:** Validates feature importance and model interpretability.

---

## T3: Two-Stage Spatial Clustering

### 3.1 Silhouette Coefficient
**Formula:**
$$S(i) = \frac{b(i) - a(i)}{\max\{a(i), b(i)\}}$$

**Where:**
- $a(i)$: Mean intra-cluster distance for point $i$
- $b(i)$: Mean nearest-cluster distance for point $i$

**Range:** [-1, 1] (higher = better separation)

**Purpose:** Objective criterion for optimal cluster count $k^*$.

---

### 3.2 Maximum Intra-Cluster Distance
**Formula:**
$$D_{\max}(C) = \max_{i,j \in C} \, d_{\text{haversine}}(i, j)$$

**Constraint:** $D_{\max}(C) \leq D_{\text{threshold}}$ (e.g., 300 km)

**Purpose:** Ensures region is actionable in a single government operation.

---

### 3.3 Region Priority Score
**Formula:**
$$\text{Priority}(R_j) = I(R_j) \cdot T(R_j) \cdot S(R_j)$$

**Components:**

#### Information Content ($I$)
$$I(R_j) = 1 - \prod_{i \in \text{Top-}K} (1 - p_i)$$
- Uses only top $K$ highest probabilities (default: $K=10$) to avoid saturation

#### Temporal Urgency ($T$)
$$T(R_j) = \exp\left(-\frac{\bar{t}_j}{\tau_T}\right)$$
- $\bar{t}_j$: Mean time since detection in region
- $\tau_T$: Decay constant (e.g., 60 days)

#### Spatial Compactness ($S$)
$$S(R_j) = \exp\left(-\frac{D_{\max}(R_j)}{D_0}\right)$$
- $D_0$: Normalization constant (e.g., 100 km)

---

## T4: Optimal Model Update Strategy

### 4.1 Numerical Derivative (First-Order Finite Difference)
**Formula:**
$$D(t) = I(t) - I(t-1)$$

**Where:** $I(t)$ = Performance metric (AUROC/AUPRC) at time $t$

**Purpose:** Detects rate of performance degradation.

---

### 4.2 Update Interval Selection Criteria

#### Epsilon Criterion
$$\max_t \left[I_{\text{baseline}}(t) - I_{\Delta}(t)\right] \leq \epsilon$$

**Parameters:**
- $\epsilon$: Acceptable performance drop (default: 0.02)
- $\Delta$: Update interval (in time windows)

**Result:** Largest $\Delta^*$ satisfying constraint.

#### Derivative Spike Criterion
$$|D_{\Delta}(t)| > \alpha \cdot |D_{\Delta-1}(t)|$$

**Parameters:**
- $\alpha$: Increase ratio threshold (default: 1.5)

**Purpose:** Identifies sudden performance collapse.

---

### 4.3 Top-10% Positive Rate
$$R_{10} = \frac{\sum_{i \in \text{Top 10\%}} y_i}{\sum_{i} y_i}$$

**Purpose:** Policy-relevant metric (concentration of true cases in recommended investigations).

---

## T5: Eradication Evidence Assessment

### 5.1 Growth Ratio ($g_t$)
**Formula:**
$$g_t = \frac{N_t}{N_{t-1}}$$

**Where:** $N_t$ = Number of positive cases in year $t$

---

### 5.2 Distribution Range Ratio ($d_t$)
**Formula:**
$$d_t = \frac{\bar{D}_{t-1}^2}{\bar{D}_t^2}$$

**Where:** $\bar{D}_t^2$ = Mean squared pairwise distance (km²) in year $t$

**Interpretation:**
- $d_t > 1$: Population contracting (good)
- $d_t < 1$: Population expanding (bad)

---

### 5.3 Positive Rate Ratio ($p_t$)
**Formula:**
$$p_t = \frac{N_t / R_t}{N_{t-1} / R_{t-1}}$$

**Where:**
- $N_t$: Positive detections in year $t$
- $R_t$: Total reports in year $t$

---

### 5.4 Evaluation Coefficient ($K_t$)
**Formula:**
$$K_t = g_t \cdot d_t \cdot p_t \cdot \theta$$

**Where:** $\theta$ = Model accuracy correction factor (e.g., 0.95)

**Eradication Criterion:**
$$K_t < K_{\text{threshold}} \quad \text{for } \geq 3 \text{ consecutive years}$$

**Default:** $K_{\text{threshold}} = 1.0$ (stable/declining threshold)

---

### 5.5 Alternative: Peak Risk Intensity Threshold
**Model:** Uses T1 spatiotemporal kernel to compute statewide maximum risk.

**Formula:**
$$R_{\max}(t) = \max_{x \in \text{Grid}} R(x, t)$$

**Eradication Criterion:**
$$R_{\max}(t) < 10^{-5} \quad \text{for } \geq 3 \text{ consecutive periods}$$

---

## Supplementary Metrics

### Haversine Distance
**Formula:**
$$d = 2R \arcsin\left(\sqrt{\sin^2\left(\frac{\Delta\phi}{2}\right) + \cos\phi_1 \cos\phi_2 \sin^2\left(\frac{\Delta\lambda}{2}\right)}\right)$$

**Where:**
- $R = 6371$ km (Earth radius)
- $\phi$: Latitude (radians)
- $\lambda$: Longitude (radians)

---

### Coordinate Transformation (lat/lon → km)
**Approximate Planar Projection:**
$$\begin{cases}
x = (\lambda - \lambda_0) \cdot 111.32 \cdot \cos\phi_0 \\
y = (\phi - \phi_0) \cdot 110.57
\end{cases}$$

**Purpose:** Used for clustering algorithms (avoids distortion from Euclidean distance on geographic coordinates).

---

## Summary Table

| Task | Key Metrics | Purpose |
|------|-------------|---------|
| **T1** | Hit Rate, AUROC, Bootstrap CI | Validate spatiotemporal prediction accuracy |
| **T2** | AUROC, AUPRC, Top-K Uplift, Logit $p$-values | Image-enhanced classification & feature significance |
| **T3** | Silhouette Score, Priority Score | Actionable region identification & ranking |
| **T4** | Numerical Derivative, $\epsilon$ Criterion | Optimal model refresh frequency |
| **T5** | $K_t$ (Growth × Range × Rate), $R_{\max}(t)$ | Evidence-based eradication assessment |

---

**Note:** All metrics are computed using cross-validated time-series splits to prevent data leakage and ensure realistic performance estimates.