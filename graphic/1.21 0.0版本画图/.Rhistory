pal_grey   <- "#B6BED2"  # 负样本/背景
pal_blue   <- "#E3EDF7"  # 强调/等高线
pal_yellow <- "#FFF4D3"  # 核心高亮 (Positive)
col_ink    <- "#2F3542"  # 深岩灰 (用于文字和线条)
# --- 杂志风主题 ---
theme_magazine <- function() {
theme_minimal(base_size = 14) +
theme(
text = element_text(family = "sans", color = col_ink),
plot.title = element_text(face = "bold", size = 18, margin = margin(b = 10)),
plot.subtitle = element_text(size = 12, color = "#57606f", margin = margin(b = 20)),
axis.line = element_line(color = col_ink, linewidth = 0.8),
axis.ticks = element_line(color = col_ink),
panel.grid.major = element_line(color = "#f0f0f0", linewidth = 0.5),
panel.grid.minor = element_blank(),
legend.position = "top",
legend.justification = "left",
legend.title = element_blank()
)
}
# 读取数据
df_labeled <- read_csv("processed_labeled_data.csv")
df_preds   <- read_csv("model_predictions_ranked.csv")
# ==============================================================================
# Chart 1: The Challenge (无需 waffle 包的修正版)
# ==============================================================================
# 逻辑：手动创建一个 10x10 的网格数据
# 1. 计算数据
counts <- table(df_labeled$y)
n_pos_raw <- counts["1"]
# 就算比例很小，也至少显示 1 个格子以便肉眼可见
pct_pos <- max(1, round((n_pos_raw / sum(counts)) * 100))
# 2. 生成网格数据 (10x10 = 100个格子)
waffle_df <- expand.grid(x = 1:10, y = 1:10) %>%
arrange(y, x) %>% # 排序
mutate(id = row_number()) %>%
mutate(category = ifelse(id <= pct_pos, "Target (Positive)", "Noise (Negative)"))
# 3. 绘图 (使用 geom_tile)
p1 <- ggplot(waffle_df, aes(x = x, y = y, fill = category)) +
geom_tile(color = "white", linewidth = 1.5) + # 白色间隔线
coord_fixed() +
scale_fill_manual(values = c("Noise (Negative)" = pal_grey, "Target (Positive)" = pal_yellow)) +
theme_void() + # 移除所有坐标轴
theme(
plot.title = element_text(face = "bold", size = 18, color = col_ink, margin = margin(b=5)),
plot.subtitle = element_text(size = 12, color = "#57606f", margin = margin(b=10)),
legend.position = "bottom",
legend.text = element_text(size = 12),
plot.margin = margin(20, 20, 20, 20)
) +
labs(title = "Figure 1: The Data Imbalance",
subtitle = "Target identification is akin to finding a needle in a haystack (<1%)")
# 添加箭头标注
p1_final <- ggdraw(p1) +
draw_label("Target", x = 0.15, y = 0.22, color = col_ink, fontface = "bold", size = 11) +
draw_line(x = c(0.18, 0.22), y = c(0.20, 0.16), color = col_ink,
arrow = arrow(length = unit(0.02, "npc"), type = "closed"))
ggsave("Chart1_Waffle_Fixed.svg", p1_final, width = 7, height = 6)
print("Chart 1 Saved.")
# ==============================================================================
# Chart 2: The Spatial Signal (保持不变)
# ==============================================================================
pos_data <- df_labeled %>% filter(y == 1)
neg_data <- df_labeled %>% filter(y == 0)
p2 <- ggplot() +
# 1. 风险等高线 (蓝色系)
stat_density_2d(data = pos_data, aes(x = Longitude, y = Latitude, fill = ..level..),
geom = "polygon", alpha = 0.6, show.legend = FALSE) +
scale_fill_gradient(low = pal_mint, high = pal_blue) +
# 2. 背景噪点 (灰色)
geom_point(data = neg_data, aes(x = Longitude, y = Latitude),
color = pal_grey, alpha = 0.4, size = 0.8) +
# 3. 目标点 (黄色 + 描边)
geom_point(data = pos_data, aes(x = Longitude, y = Latitude),
fill = pal_yellow, color = col_ink, shape = 21, size = 3.5, stroke = 0.8) +
coord_fixed(ratio = 1.3) +
theme_magazine() +
labs(title = "Figure 2: Spatial Clustering",
subtitle = "Valid sightings align with high-risk contour zones",
x = "Longitude", y = "Latitude") +
annotate("curve", x = -122.5, y = 48.5, xend = -122.3, yend = 48.8,
curvature = -0.2, arrow = arrow(length = unit(2, "mm")), color = col_ink) +
annotate("text", x = -122.5, y = 48.4, label = "High Density\nCluster",
hjust = 0.5, vjust = 1, color = col_ink, size = 4)
ggsave("Chart2_Spatial.svg", p2, width = 8, height = 7)
print("Chart 2 Saved.")
# ==============================================================================
# Chart 3: Feature Discriminators (保持不变)
# ==============================================================================
df_plot3 <- df_labeled %>%
mutate(
Class = factor(ifelse(y == 1, "Verified Positive", "Mistaken Reports"),
levels = c("Verified Positive", "Mistaken Reports")),
LogDist = log1p(dist_to_positive)
)
p3 <- ggplot(df_plot3, aes(x = LogDist, y = Class, fill = Class)) +
stat_halfeye(adjust = 0.6, width = 0.6, .width = 0, justification = -0.2,
color = NA, alpha = 0.9) +
geom_boxplot(width = 0.15, outlier.shape = NA, alpha = 0.5, color = col_ink,
position = position_nudge(x = 0)) +
geom_point(position = position_jitter(width = 0, height = 0.05),
size = 0.5, alpha = 0.3, color = col_ink) +
scale_fill_manual(values = c("Verified Positive" = pal_mint, "Mistaken Reports" = pal_grey)) +
theme_magazine() +
theme(legend.position = "none") +
labs(title = "Figure 3: Feature Discrimination",
subtitle = "Distance to nearest positive (Log Scale) separates classes",
x = "Log(Distance)", y = NULL) +
annotate("segment", x = 1, xend = 4, y = 1.3, yend = 1.3,
arrow = arrow(length = unit(2, "mm"), ends = "both"), color = col_ink) +
annotate("text", x = 2.5, y = 1.4, label = "Clear Separation",
color = col_ink, fontface = "italic")
ggsave("Chart3_Raincloud.svg", p3, width = 8, height = 5)
print("Chart 3 Saved.")
# ==============================================================================
# Chart 4: Solution Impact (保持不变)
# ==============================================================================
gain_data <- df_preds %>%
arrange(desc(prob)) %>%
mutate(pct = row_number() / n(), recall = cumsum(y) / sum(y))
pt_10 <- gain_data %>% filter(pct >= 0.1) %>% slice(1)
recall_val <- pt_10$recall
p4 <- ggplot(gain_data, aes(x = pct, y = recall)) +
geom_ribbon(aes(ymin = pct, ymax = recall), fill = pal_mint, alpha = 0.3) +
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = pal_grey, linewidth = 1) +
geom_line(color = "#5D6D7E", linewidth = 1.2) +
geom_segment(aes(x = 0.1, xend = 0.1, y = 0, yend = recall_val),
linetype = "dotted", color = col_ink) +
geom_segment(aes(x = 0, xend = 0.1, y = recall_val, yend = recall_val),
linetype = "dotted", color = col_ink) +
geom_point(data = pt_10, aes(x = pct, y = recall),
color = col_ink, fill = pal_yellow, shape = 21, size = 4, stroke = 1.5) +
scale_x_continuous(labels = percent_format(), limits = c(0, 1), expand = c(0,0)) +
scale_y_continuous(labels = percent_format(), limits = c(0, 1.05), expand = c(0,0)) +
theme_magazine() +
labs(title = "Figure 4: Model Efficiency",
subtitle = "Prioritizing Top 10% reports captures ~50% of targets",
x = "% Reports Investigated", y = "Recall") +
annotate("text", x = 0.15, y = recall_val - 0.05,
label = paste0("Lift: ", round(recall_val/0.1, 1), "x"),
hjust = 0, color = col_ink, fontface = "bold")
ggsave("Chart4_CumulativeGain.svg", p4, width = 7, height = 6)
print("Chart 4 Saved.")
print("All done!")
# ==============================================================================
# 0. 环境设置与风格定义
# ==============================================================================
# 只需要安装这些常见的包
if(!require(tidyverse)) install.packages("tidyverse")
if(!require(ggdist))    install.packages("ggdist")
if(!require(svglite))   install.packages("svglite")
if(!require(cowplot))   install.packages("cowplot")
if(!require(scales))    install.packages("scales")
library(tidyverse)
library(ggplot2)
library(ggdist)     # 雨云图
library(svglite)    # SVG输出
library(cowplot)    # 拼图与主题
library(scales)     # 格式化
# 设置工作目录 (请确认此处路径正确)
setwd("E:/美赛/2021C/code/MCM2021c/graphic")
# --- 新配色方案: Bright Morandi (Coral & Teal) ---
pal_target <- "#EE6F57"  # 核心: 柿红 (用于 Positive / Top 10%)
pal_noise  <- "#4F8699"  # 次要: 灰蓝 (用于 Negative / Mistaken)
pal_fill   <- "#C8E0E0"  # 辅助: 冰川蓝 (用于 填充 / 背景)
pal_bg     <- "#F9FAFB"  # 画布: 极淡的灰白 (提升杂志感)
col_ink    <- "#2C3E50"  # 线条: 午夜蓝
# --- 杂志风主题 V2 ---
theme_sci_v2 <- function() {
theme_minimal(base_size = 14) +
theme(
# 全局字体颜色
text = element_text(family = "sans", color = col_ink),
# 标题与副标题
plot.title = element_text(face = "bold", size = 20, color = col_ink, margin = margin(b = 8)),
plot.subtitle = element_text(size = 12, color = "#637282", margin = margin(b = 20), face = "italic"),
# 坐标轴: 加粗，带颜色
axis.line = element_line(color = col_ink, linewidth = 0.8),
axis.text = element_text(color = col_ink, size = 11),
axis.title = element_text(face = "bold", size = 12),
# 网格线: 极简，只留水平或垂直的主网格
panel.grid.major = element_line(color = "#E1E8ED", linewidth = 0.5),
panel.grid.minor = element_blank(),
# 背景色 (非纯白，护眼且高级)
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = pal_bg, color = NA),
# 图例
legend.position = "top",
legend.justification = "left"
)
}
# 读取数据
df_labeled <- read_csv("processed_labeled_data.csv")
df_preds   <- read_csv("model_predictions_ranked.csv")
# ==============================================================================
# Chart 1: The Challenge (Waffle Grid)
# ==============================================================================
# 1. 计算
counts <- table(df_labeled$y)
pct_pos <- max(1, round((counts["1"] / sum(counts)) * 100))
# 2. 构造数据
waffle_df <- expand.grid(x = 1:10, y = 1:10) %>%
arrange(y, x) %>%
mutate(id = row_number()) %>%
mutate(category = ifelse(id <= pct_pos, "Target (Positive)", "Noise (Negative)"))
# 3. 绘图 (明亮风格)
p1 <- ggplot(waffle_df, aes(x = x, y = y, fill = category)) +
geom_tile(color = "white", linewidth = 1.2) + # 加粗白色边框，增加积木感
coord_fixed() +
scale_fill_manual(values = c("Noise (Negative)" = pal_fill,  # 噪音用浅色，不抢眼
"Target (Positive)" = pal_target)) + # 目标用亮色
theme_void() +
theme(
plot.title = element_text(face = "bold", size = 18, color = col_ink),
plot.subtitle = element_text(size = 12, color = "#637282"),
legend.position = "bottom",
legend.text = element_text(size = 12, color = col_ink),
plot.margin = margin(20, 20, 20, 20)
) +
labs(title = "Figure 1: The Imbalance",
subtitle = "Target signals (<1%) are overwhelmed by noise")
# 添加标注
p1_final <- ggdraw(p1) +
draw_label("Target", x = 0.18, y = 0.23, color = pal_target, fontface = "bold", size = 12) +
draw_line(x = c(0.20, 0.23), y = c(0.21, 0.17), color = pal_target,
arrow = arrow(length = unit(2, "mm"), type = "closed"))
ggsave("Chart1_Waffle_Vibrant.svg", p1_final, width = 7, height = 6)
# ==============================================================================
# Chart 2: The Spatial Signal (Clustering)
# ==============================================================================
pos_data <- df_labeled %>% filter(y == 1)
neg_data <- df_labeled %>% filter(y == 0)
p2 <- ggplot() +
# 1. 风险等高线 (使用 Teal 色系渐变)
stat_density_2d(data = pos_data, aes(x = Longitude, y = Latitude, fill = ..level..),
geom = "polygon", alpha = 0.5, show.legend = FALSE) +
scale_fill_gradient(low = pal_fill, high = pal_noise) + # 浅蓝 -> 深蓝
# 2. 背景噪点 (半透明 Teal)
geom_point(data = neg_data, aes(x = Longitude, y = Latitude),
color = pal_noise, alpha = 0.2, size = 1) +
# 3. 目标点 (柿红 + 白色描边)
geom_point(data = pos_data, aes(x = Longitude, y = Latitude),
fill = pal_target, color = "white", shape = 21, size = 4, stroke = 1) +
coord_fixed(ratio = 1.3) +
theme_sci_v2() +
labs(title = "Figure 2: Spatial Signal",
subtitle = "High-risk clusters emerge from the chaotic background",
x = "Longitude", y = "Latitude") +
# 标注
annotate("text", x = -122.5, y = 48.35, label = "Core Cluster",
color = col_ink, fontface = "bold") +
annotate("segment", x = -122.5, xend = -122.4, y = 48.4, yend = 48.7,
colour = col_ink, arrow = arrow(length = unit(2, "mm")))
ggsave("Chart2_Spatial_Vibrant.svg", p2, width = 8, height = 7)
# ==============================================================================
# Chart 3: Feature Discriminators (Raincloud)
# ==============================================================================
df_plot3 <- df_labeled %>%
mutate(
Class = factor(ifelse(y == 1, "Positive", "Mistaken"),
levels = c("Positive", "Mistaken")),
LogDist = log1p(dist_to_positive)
)
p3 <- ggplot(df_plot3, aes(x = LogDist, y = Class, fill = Class, color = Class)) +
# 1. 云 (Density)
stat_halfeye(adjust = 0.6, width = 0.6, .width = 0, justification = -0.2,
alpha = 0.8, color = NA) +
# 2. 箱 (Box) - 白色填充，增加层次感
geom_boxplot(width = 0.2, outlier.shape = NA, alpha = 0.9,
color = col_ink, fill = "white",
position = position_nudge(x = 0)) +
# 3. 雨 (Points)
geom_point(position = position_jitter(width = 0, height = 0.08),
size = 1, alpha = 0.4) +
scale_fill_manual(values = c("Positive" = pal_target, "Mistaken" = pal_noise)) +
scale_color_manual(values = c("Positive" = pal_target, "Mistaken" = pal_noise)) +
theme_sci_v2() +
theme(legend.position = "none") +
labs(title = "Figure 3: Feature Separation",
subtitle = "Distance metrics (Log Scale) clearly distinguish true positives",
x = "Log(Distance to Nearest Positive)", y = NULL) +
annotate("text", x = 3, y = 1.5, label = "Distinct separation",
color = col_ink, fontface = "italic")
ggsave("Chart3_Raincloud_Vibrant.svg", p3, width = 8, height = 5)
# ==============================================================================
# Chart 4: Solution Impact (Lift Chart)
# ==============================================================================
gain_data <- df_preds %>%
arrange(desc(prob)) %>%
mutate(pct = row_number() / n(), recall = cumsum(y) / sum(y))
pt_10 <- gain_data %>% filter(pct >= 0.1) %>% slice(1)
recall_val <- pt_10$recall
p4 <- ggplot(gain_data, aes(x = pct, y = recall)) +
# 1. 面积填充 (使用辅助色)
geom_ribbon(aes(ymin = pct, ymax = recall), fill = pal_fill, alpha = 0.4) +
# 2. 基准线
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "#95A5A6", linewidth = 1) +
# 3. 模型主线 (使用次要色，深色版)
geom_line(color = pal_noise, linewidth = 1.5) +
# 4. 辅助线
geom_segment(aes(x = 0.1, xend = 0.1, y = 0, yend = recall_val),
linetype = "dotted", color = col_ink, linewidth = 0.6) +
geom_segment(aes(x = 0, xend = 0.1, y = recall_val, yend = recall_val),
linetype = "dotted", color = col_ink, linewidth = 0.6) +
# 5. 关键点 (柿红)
geom_point(data = pt_10, aes(x = pct, y = recall),
color = "white", fill = pal_target, shape = 21, size = 5, stroke = 1.5) +
scale_x_continuous(labels = percent_format(), limits = c(0, 1), expand = c(0,0)) +
scale_y_continuous(labels = percent_format(), limits = c(0, 1.05), expand = c(0,0)) +
theme_sci_v2() +
labs(title = "Figure 4: Model Efficiency",
subtitle = "Prioritizing top 10% reports yields a significant performance lift",
x = "Percentage of Reports Investigated",
y = "Recall (True Positives Found)") +
annotate("text", x = 0.12, y = recall_val,
label = paste0("Lift: ", round(recall_val/0.1, 1), "x"),
hjust = 0, color = pal_target, fontface = "bold", size = 5)
ggsave("Chart4_CumulativeGain_Vibrant.svg", p4, width = 7, height = 6)
print("Charts exported with Vibrant Morandi Palette.")
# --- 1. 配色方案 ---
# Cool Tones (Ref: Sample 1/Negative)
col_cool_main <- "#B6B3D6"  # 丁香紫 (主体冷色)
col_cool_pale <- "#D5D3DE"  # 浅紫灰 (背景冷色)
# Warm Tones (Ref: Sample 4/Positive)
col_warm_main <- "#E9687A"  # 西瓜红 (核心亮色)
col_warm_pale <- "#F6DFD6"  # 裸粉色 (辅助暖色)
# Structure Colors
col_text      <- "#505050"  # 柔和深灰
col_axis      <- "#333333"  # 轴线色
# --- 2. 定义生信艺术风格主题 (Bio-Art Theme) ---
theme_omics <- function() {
theme_classic(base_size = 14) +
theme(
# 字体与颜色
text = element_text(family = "sans", color = col_text),
plot.title = element_text(face = "bold", size = 16, hjust = 0, color = "black"),
plot.subtitle = element_text(size = 11, color = col_text, margin = margin(b = 15)),
# 坐标轴设计 (参考图：黑色细轴，无网格)
axis.line = element_line(color = "black", linewidth = 0.6),
axis.ticks = element_line(color = "black", linewidth = 0.6),
axis.text = element_text(color = "black", size = 10),
axis.title = element_text(size = 12, face = "bold"),
# 去除背景和网格
panel.grid = element_blank(),
plot.background = element_rect(fill = "white", color = NA),
panel.background = element_rect(fill = "white", color = NA),
# 图例
legend.position = "top",
legend.justification = "right",
legend.title = element_blank(),
legend.key.size = unit(0.5, "cm")
)
}
# 读取数据
df_labeled <- read_csv("processed_labeled_data.csv")
df_preds   <- read_csv("model_predictions_ranked.csv")
# ==============================================================================
# Chart 1: The Challenge -> "Dot Matrix" (点阵图)
# ==============================================================================
# 设计思路：参考图左上角的散点。
# 用圆形代替方块，Negative用浅紫灰，Positive用西瓜红，体现极简几何美感。
counts <- table(df_labeled$y)
pct_pos <- max(1, round((counts["1"] / sum(counts)) * 100))
# 构造 10x10 数据
waffle_df <- expand.grid(x = 1:10, y = 1:10) %>%
arrange(y, x) %>%
mutate(id = row_number()) %>%
mutate(category = ifelse(id <= pct_pos, "Target", "Noise"))
p1 <- ggplot(waffle_df, aes(x = x, y = y, fill = category, color = category)) +
# 使用圆形 (Shape 21)，白色描边，模拟细胞/散点质感
geom_point(shape = 21, size = 12, stroke = 1.5, color = "white") +
coord_fixed() +
scale_fill_manual(values = c("Noise" = col_cool_main, "Target" = col_warm_main)) +
theme_void() +
theme(
plot.title = element_text(face = "bold", size = 16, margin = margin(b=5, l=10)),
plot.subtitle = element_text(size = 11, color = col_text, margin = margin(b=10, l=10)),
legend.position = "none" # 移除图例，直接用标注
) +
labs(title = "Figure 1. Imbalance",
subtitle = "Target signal (<1%) hidden in massive noise") +
# 手动标注 (生信图常用方式)
annotate("text", x = 1.5, y = 1.5, label = "Target", color = col_warm_main, fontface = "bold", size = 5) +
annotate("text", x = 5.5, y = 5.5, label = "Noise / Background", color = col_cool_main, size = 6, fontface="bold", alpha=0.5)
ggsave("Style_Chart1_DotMatrix.svg", p1, width = 6, height = 6)
# ==============================================================================
# Chart 2: Spatial Signal -> "Soft Density" (柔和密度图)
# ==============================================================================
# 设计思路：使用淡裸粉色 (Pale Peach) 晕染背景，叠加清晰的红点。
# 这种配色非常符合 Omics 风格中的 "Heatmap" 或 "Spatial Transcriptomics" 质感。
pos_data <- df_labeled %>% filter(y == 1)
neg_data <- df_labeled %>% filter(y == 0)
p2 <- ggplot() +
# 1. 密度晕染 (使用淡裸粉色，边缘羽化)
stat_density_2d(data = pos_data, aes(x = Longitude, y = Latitude, fill = ..level..),
geom = "polygon", alpha = 0.4, show.legend = FALSE) +
scale_fill_gradient(low = "white", high = col_warm_main) +
# 2. 背景噪音 (使用浅紫灰，极小点，作为纹理)
geom_point(data = neg_data, aes(x = Longitude, y = Latitude),
color = col_cool_main, alpha = 0.3, size = 0.5) +
# 3. 核心目标 (西瓜红 + 白色描边)
geom_point(data = pos_data, aes(x = Longitude, y = Latitude),
fill = col_warm_main, color = "white", shape = 21, size = 3, stroke = 0.5) +
coord_fixed(ratio = 1.3) +
theme_omics() +
labs(title = "Figure 2. Spatial Clustering",
subtitle = "Signals form distinct high-density clusters",
x = "Longitude", y = "Latitude")
ggsave("Style_Chart2_Spatial.svg", p2, width = 7, height = 6)
# ==============================================================================
# Chart 3: Feature Discriminators -> "Violin Box" (复刻参考图右上角)
# ==============================================================================
# 设计思路：这是最能体现参考图风格的一张。
# 宽大的小提琴图展示分布，内部嵌套细长的白色箱线图。
df_plot3 <- df_labeled %>%
mutate(
Class = factor(ifelse(y == 1, "Positive", "Mistaken"),
levels = c("Mistaken", "Positive")), # 冷色在前，暖色在后
LogDist = log1p(dist_to_positive)
)
p3 <- ggplot(df_plot3, aes(x = Class, y = LogDist, fill = Class, color = Class)) +
# 1. 小提琴图 (去除两端截断 trim=FALSE，增加流动感)
geom_violin(trim = FALSE, alpha = 0.9, color = NA, width = 0.7) +
# 2. 箱线图 (纯白填充，黑色细线，极窄) -> 参考图的关键特征
geom_boxplot(width = 0.1, fill = "white", color = "black",
outlier.size = 1, outlier.alpha = 0.5, size = 0.3) +
# 配色映射
scale_fill_manual(values = c("Mistaken" = col_cool_main, "Positive" = col_warm_main)) +
theme_omics() +
theme(legend.position = "none") +
labs(title = "Figure 3. Feature Distribution",
subtitle = "Distance metric effectively separates true positives",
x = NULL, # 移除X轴标签，直接看类别
y = "Log(Distance)")
ggsave("Style_Chart3_Violin.svg", p3, width = 6, height = 5)
# ==============================================================================
# Chart 4: Solution Impact -> "Area Lift" (区域增益图)
# ==============================================================================
# 设计思路：使用填充面积图 (Area Chart) 代替单薄的折线。
# 填充色使用淡裸粉色，轮廓线使用西瓜红，视觉上非常饱满。
gain_data <- df_preds %>%
arrange(desc(prob)) %>%
mutate(pct = row_number() / n(), recall = cumsum(y) / sum(y))
pt_10 <- gain_data %>% filter(pct >= 0.1) %>% slice(1)
recall_val <- pt_10$recall
p4 <- ggplot(gain_data, aes(x = pct, y = recall)) +
# 1. 面积填充 (淡暖色)
geom_ribbon(aes(ymin = 0, ymax = recall), fill = col_warm_pale, alpha = 0.6) +
# 2. 基准线 (深灰色虚线)
geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "#999999", linewidth = 0.5) +
# 3. 模型曲线 (西瓜红实线)
geom_line(color = col_warm_main, linewidth = 1.2) +
# 4. 关键点 (Top 10%)
geom_point(data = pt_10, aes(x = pct, y = recall),
color = "white", fill = col_warm_main, shape = 21, size = 4, stroke = 1.5) +
# 5. 辅助垂直线
geom_segment(aes(x = 0.1, xend = 0.1, y = 0, yend = recall_val),
linetype = "dotted", color = col_text) +
scale_x_continuous(labels = percent_format(), limits = c(0, 1), expand = c(0,0)) +
scale_y_continuous(labels = percent_format(), limits = c(0, 1.05), expand = c(0,0)) +
theme_omics() +
labs(title = "Figure 4. Model Efficiency",
subtitle = "Top 10% prioritization captures ~50% of targets",
x = "Percentage of Reports Investigated",
y = "Recall (True Positives)") +
annotate("text", x = 0.15, y = recall_val,
label = paste0("Lift: ", round(recall_val/0.1, 1), "x"),
hjust = 0, color = col_warm_main, fontface = "bold", size = 5)
ggsave("Style_Chart4_Lift.svg", p4, width = 6, height = 5)
print("All charts exported with 'Omics Bio-Art' style.")
library(ggplot2)
library(dplyr)
library(readxl)
library(sf)
library(waffle)
packages <- c("waffle")
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
install.packages(packages[!installed_packages])
}
library(waffle)
install.packages("remotes")
remotes::install_github("hrbrmstr/waffle")
library(ggplot2)
library(dplyr)
library(readxl)
library(sf)
library(waffle)
library(ggdist)
library(patchwork)
library(showtext)
library(maps)
install.packages('maps')
install.packages('patchwork')
library(waffle)
library(ggdist)
library(patchwork)
install.packages('patchwork')
library(patchwork)
packageVersion("R")
getRversion()
# 1) 更新 ggplot2（关键）
install.packages("ggplot2", type = "win.binary")
# 2) 关掉并重开 R/RStudio（避免旧 ggplot2 还在内存里）
# 3) 安装 patchwork（用二进制）
install.packages("patchwork", type = "win.binary")
# 4) 加载
library(patchwork)
# 5) 验证版本
packageVersion("ggplot2")
packageVersion("patchwork")
install.packages("ggplot2", type = "win.binary")
